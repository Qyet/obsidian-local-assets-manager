# Local Assets Manager 敏捷型 PRD | V0.1.0 | 2025Q2-01

## 一、文档基本信息

### 1.1 版本更新日志

| 版本号 | 更新日期 | 主要更新内容 | 作者 | 审批人 |
| ------ | -------- | ------------ | ---- | ------ |
| V0.1.0 | 2025-04-29 | 初始版本，定义核心功能与首期迭代计划 | Qyet | - |

## 二、项目概述

### 2.1 项目背景

- **业务痛点**：Obsidian用户在进行资源管理时，常遇到以下问题：
  - 外部资源存在防盗链保护无法显示
  - 资源依赖外部存储存在失效风险
  - 资源下载失败时缺乏有效错误提示
  - 本地资源管理不便

### 2.2 项目目标

- **核心目标**：
  - 实现外部资源的本地化和永久保存
  - 提供智能的资源管理功能
  - 确保资源的长期可访问性
- **衍生目标**：
  - 提升用户笔记编写体验
  - 降低资源失效风险
  - 优化资源组织效率

### 2.3 项目范围

- **核心功能**：
  - 外部资源本地化下载
  - 防盗链突破
  - 资源路径管理
  - 资源同步更新
  - 批量下载处理
- **不包含内容**：
  - 不支持加密资源下载
  - 不提供资源编辑功能
  - 不支持云端存储同步

## 三、核心需求

### 3.1 用户故事列表

#### 用户故事1：资源本地化下载

- **用户角色**：Obsidian笔记编写者
- **需求描述**：将笔记中的外部图片、视频等媒体文件下载到本地
- **验收标准**：
  1. 支持从剪贴板URL获取资源
  2. 自动创建本地存储目录
  3. 下载完成后自动更新笔记中的链接
- **优先级**：High
- **依赖关系**：无

#### 用户故事2：防盗链处理

- **用户角色**：需要下载防盗链资源的用户
- **需求描述**：通过配置Referer规则突破网站的防盗链限制
- **验收标准**：
  1. 支持自定义Referer规则配置
  2. 能成功下载主流网站的防盗链资源
  3. 配置规则即时生效
- **优先级**：High
- **依赖关系**：依赖资源本地化下载功能

#### 用户故事3：资源路径管理

- **用户角色**：需要组织管理本地资源的用户
- **需求描述**：根据笔记标题自动组织资源文件结构
- **验收标准**：
  1. 支持{title}占位符配置
  2. 笔记重命名时自动更新资源路径
  3. 支持相对路径引用
- **优先级**：Medium
- **依赖关系**：依赖资源本地化下载功能

### 3.2 功能模块拆解

#### 模块1：下载管理

- **交互说明**：
  - 下载流程：URL解析 → 请求发送 → 资源保存 → 链接更新
  - 异常处理：网络错误重试、超时提示、防盗链检测
- **业务规则**：
  - 下载超时：默认30秒
  - 重试策略：失败自动重试1次
  - 并发限制：最大5个同时下载任务

#### 模块2：路径管理

- **交互说明**：
  - 路径生成：解析笔记标题 → 创建目录 → 生成资源路径
  - 路径更新：监听笔记重命名 → 更新资源位置 → 更新链接引用
- **业务规则**：
  - 目录命名：assets/{title}
  - 文件命名：{原文件名}-{时间戳}.{扩展名}
  - 路径类型：支持相对路径和绝对路径

## 四、非功能需求

### 4.1 性能要求

- 单文件下载响应时间 < 5s
- 支持并发下载（最大5线程）
- 内存占用控制在100MB以内

### 4.2 兼容性要求

- Obsidian版本 >= 0.15.0
- 支持Windows/macOS/Linux平台
- 支持主流图片和视频格式

### 4.3 安全性要求

- 不收集用户数据
- 所有请求仅限资源下载
- 防止恶意URL注入

## 五、迭代计划

### 5.1 迭代周期与目标

| 迭代阶段 | 时间范围 | 核心目标 | 包含用户故事 |
| -------- | -------- | -------- | ------------ |
| 冲刺S1 | 2025-04-29至05-13 | 完成基础下载功能 | 用户故事1 |
| 冲刺S2 | 2025-05-14至05-28 | 实现防盗链和路径管理 | 用户故事2、3 |

### 5.2 交付物清单

- 可运行的插件包
- 使用文档
- 单元测试用例
- API接口文档

## 六、验收标准

### 6.1 冲刺S1验收标准

- 基础资源下载功能可用
- 支持常见媒体格式
- 下载进度显示正常

### 6.2 冲刺S2验收标准

- 防盗链规则配置有效
- 资源路径管理正常工作
- 异常处理机制完善

## 七、风险评估与应对

| 风险项 | 发生概率 | 影响程度 | 应对措施 |
| ------ | -------- | -------- | -------- |
| 网站防盗链策略变更 | High | 下载功能失效 | 提供自定义规则配置，快速响应更新 |
| 资源路径冲突 | Medium | 文件覆盖 | 使用时间戳确保文件名唯一 |
| 性能问题 | Low | 用户体验下降 | 实现并发控制和超时机制 |

## 八、附录

1. **源码仓库**：[GitHub Repository](https://github.com/qyet/obsidian-local-assets-manager)
2. **问题反馈**：[GitHub Issues](https://github.com/qyet/obsidian-local-assets-manager/issues)
3. **术语表**：
   - **防盗链**：网站通过检查请求头的Referer字段限制资源访问
   - **资源路径**：媒体文件在本地存储的目录结构
   - **占位符**：在配置中使用的动态替换标记，如{title}

## 文档说明

- **敏捷原则**：本PRD遵循"最小必要信息"原则，细节通过GitHub Issues和代码注释同步。
- **动态更新**：需求变更通过GitHub Issues跟踪，PRD仅记录最终确认的核心方案。 